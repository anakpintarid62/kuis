<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuis Memori Buah - Tanpa Musik</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #1e293b;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        #game-container {
            aspect-ratio: 16/9;
            width: 100%;
            max-width: 1000px;
            background-color: #ffffff;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        @keyframes happyFruit {
            0% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.3) rotate(-20deg); }
            50% { transform: scale(1.1) rotate(20deg); }
            75% { transform: scale(1.3) rotate(-20deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        .animate-fruit {
            animation: happyFruit 1.5s ease-in-out infinite;
            filter: drop-shadow(0 0 10px rgba(250, 204, 21, 0.8));
        }

        .perspective-1000 { perspective: 1000px; }
        .card-inner {
            transition: transform 0.6s;
            transform-style: preserve-3d;
            width: 100%;
            height: 100%;
        }
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .card-front {
            background-color: #f8fafc;
            transform: rotateY(0deg);
            border: 3px solid #e2e8f0;
        }
        .card-back {
            background-color: #3b82f6;
            color: white;
            transform: rotateY(180deg);
            font-size: 3rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            border: 3px solid #2563eb;
        }
        
        .flipped .card-inner { transform: rotateY(180deg); }
        
        .correct .card-inner { transform: rotateY(0deg); }
        .correct .card-front {
            background-color: #facc15 !important;
            border: 5px solid #ca8a04;
        }

        .emoji-icon { font-size: 4rem; }
        
        .grid-layout {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            width: 80%;
            padding: 1rem;
            position: relative;
        }
    </style>
</head>
<body>

    <div id="game-container" class="rounded-none shadow-2xl border-8 border-gray-800">
        
        <div class="absolute top-6 w-full text-center px-4 z-10">
            <h1 class="text-4xl font-extrabold text-blue-600 drop-shadow-sm mb-2" style="-webkit-text-stroke: 1px white;">Kuis Hafalan Buah üçé</h1>
            <div id="instruction-box" class="bg-white/90 backdrop-blur-sm py-2 px-6 rounded-full inline-block shadow-md">
                <p id="instruction" class="text-2xl text-gray-800 font-bold">Siap bermain?</p>
            </div>
        </div>

        <div class="absolute top-0 left-0 w-full h-3 bg-gray-200 z-20">
            <div id="progress-bar" class="h-full bg-blue-500 transition-all duration-100 ease-linear" style="width: 0%"></div>
        </div>

        <div id="game-grid" class="grid-layout mt-12">
            <!-- Kartu digenerate JS -->
        </div>

        <div id="controls" class="absolute bottom-8 z-20">
            <button onclick="startGame()" class="bg-red-600 hover:bg-red-700 text-white text-xl font-bold py-3 px-10 rounded-full shadow-lg transform transition hover:scale-105 border-4 border-white">
                üé¨ Mulai Kuis
            </button>
        </div>

    </div>

    <script>
        // Database buah yang diperluas
        const allFruits = [
            { name: 'Apel', emoji: 'üçé', id: 'apple' },
            { name: 'Pisang', emoji: 'üçå', id: 'banana' },
            { name: 'Anggur', emoji: 'üçá', id: 'grape' },
            { name: 'Jeruk', emoji: 'üçä', id: 'orange' },
            { name: 'Stroberi', emoji: 'üçì', id: 'strawberry' },
            { name: 'Semangka', emoji: 'üçâ', id: 'watermelon' },
            { name: 'Mangga', emoji: 'ü•≠', id: 'mango' },
            { name: 'Nanas', emoji: 'üçç', id: 'pineapple' },
            { name: 'Ceri', emoji: 'üçí', id: 'cherry' },
            { name: 'Pir', emoji: 'üçê', id: 'pear' },
            { name: 'Kiwi', emoji: 'ü•ù', id: 'kiwi' },
            { name: 'Lemon', emoji: 'üçã', id: 'lemon' },
            { name: 'Kelapa', emoji: 'ü••', id: 'coconut' },
            { name: 'Alpukat', emoji: 'ü•ë', id: 'avocado' },
            { name: 'Melon', emoji: 'üçà', id: 'melon' },
            { name: 'Persik', emoji: 'üçë', id: 'peach' }
        ];

        let currentFruits = [];
        let targetFruit = null;
        let timerInterval;

        const gridEl = document.getElementById('game-grid');
        const instructionEl = document.getElementById('instruction');
        const controlsEl = document.getElementById('controls');
        const progressBar = document.getElementById('progress-bar');

        function shuffle(array) {
            return array.sort(() => Math.random() - 0.5);
        }

        function renderGrid(fruits) {
            gridEl.innerHTML = '';
            fruits.forEach((fruit, index) => {
                const card = document.createElement('div');
                card.className = 'perspective-1000 w-full h-40 relative'; 
                card.id = `card-container-${index}`; 
                
                card.dataset.fruitId = fruit.id;
                card.dataset.fruitName = fruit.name;
                card.dataset.fruitEmoji = fruit.emoji;
                
                card.innerHTML = `
                    <div class="card-inner" id="card-inner-${index}">
                        <div class="card-front">
                            <span class="emoji-icon" id="fruit-icon-${index}">${fruit.emoji}</span>
                        </div>
                        <div class="card-back">
                            ${index + 1}
                        </div>
                    </div>
                `;
                gridEl.appendChild(card);
            });
        }

        function startGame() {
            controlsEl.style.display = 'none';
            
            // Ambil 6 buah secara acak dari kumpulan besar untuk ronde ini
            const shuffledAll = shuffle([...allFruits]); 
            currentFruits = shuffledAll.slice(0, 6);
            
            renderGrid(currentFruits);

            // 1. Fase Hafalan
            instructionEl.innerText = "Hafalkan posisi buah ini! üëÄ";
            instructionEl.className = "text-2xl text-blue-800 font-bold";
            runTimer(4000, 'blue', () => {
                startHidingPhase();
            });
        }

        function startHidingPhase() {
            const cards = document.querySelectorAll('.card-inner');
            cards.forEach(c => c.parentNode.classList.add('flipped'));

            // 2. Fase Menutup & Animasi Acak (6 Detik)
            instructionEl.innerText = "Mengacak posisi... perhatikan! üé≤";
            instructionEl.className = "text-2xl text-gray-800 font-bold";
            
            setTimeout(() => {
                let swapCount = 0;
                const maxSwaps = 8;
                const swapInterval = 600;

                const shuffler = setInterval(() => {
                    if (swapCount >= maxSwaps) {
                        clearInterval(shuffler);
                    } else {
                        performVisualSwap();
                        swapCount++;
                    }
                }, swapInterval);
            }, 800);

            runTimer(6000, 'gray', () => {
                startQuestionPhase();
            });
        }

        function performVisualSwap() {
            const grid = document.getElementById('game-grid');
            const items = Array.from(grid.children);
            
            let idx1 = Math.floor(Math.random() * items.length);
            let idx2 = Math.floor(Math.random() * items.length);
            while (idx1 === idx2) idx2 = Math.floor(Math.random() * items.length);

            const item1 = items[idx1];
            const item2 = items[idx2];

            const rect1 = item1.getBoundingClientRect();
            const rect2 = item2.getBoundingClientRect();
            const deltaX = rect2.left - rect1.left;
            const deltaY = rect2.top - rect1.top;

            item1.style.transition = 'transform 0.4s ease-in-out';
            item2.style.transition = 'transform 0.4s ease-in-out';

            item1.style.transform = `translate(${deltaX}px, ${deltaY}px)`;
            item2.style.transform = `translate(${-deltaX}px, ${-deltaY}px)`;

            setTimeout(() => {
                item1.style.transition = 'none';
                item2.style.transition = 'none';
                item1.style.transform = '';
                item2.style.transform = '';

                const next1 = item1.nextSibling;
                const parent = item1.parentNode;

                if (next1 === item2) {
                    parent.insertBefore(item2, item1);
                } else if (item2.nextSibling === item1) {
                    parent.insertBefore(item1, item2);
                } else {
                    const temp = document.createTextNode('');
                    parent.insertBefore(temp, item1);
                    parent.insertBefore(item1, item2);
                    parent.insertBefore(item2, temp);
                    parent.removeChild(temp);
                }
            }, 400);
        }

        function startQuestionPhase() {
            const cards = Array.from(document.querySelectorAll('.perspective-1000'));
            const randomCard = cards[Math.floor(Math.random() * cards.length)];
            
            const targetId = randomCard.dataset.fruitId;
            const targetEmoji = randomCard.dataset.fruitEmoji;
            const targetName = randomCard.dataset.fruitName;

            targetFruit = { id: targetId, emoji: targetEmoji, name: targetName };

            instructionEl.innerHTML = `Dimana buah <span class="text-red-600 text-3xl mx-1">${targetEmoji}</span> ${targetName}?`;
            
            // 3. Fase Menunggu Jawaban
            runTimer(5000, 'red', () => {
                autoRevealAnswer();
            });
        }

        function autoRevealAnswer() {
            const allCards = Array.from(document.querySelectorAll('.perspective-1000'));
            const correctCardIndex = allCards.findIndex(card => card.dataset.fruitId === targetFruit.id);
            const correctCard = allCards[correctCardIndex];
            
            const cardInner = correctCard.querySelector('.card-inner');
            const fruitIcon = correctCard.querySelector('.emoji-icon');
            const displayedNumber = correctCard.querySelector('.card-back').innerText.trim();

            instructionEl.innerHTML = `Jawabannya di nomor <span class="text-blue-600 font-bold text-3xl">${displayedNumber}</span>! üéâ`;
            
            cardInner.parentNode.classList.remove('flipped');
            
            setTimeout(() => {
                cardInner.parentNode.classList.add('correct');
                fruitIcon.classList.add('animate-fruit');
            }, 300);

            // LOGIKA RESTART OTOMATIS
            setTimeout(() => {
                instructionEl.innerText = "Lanjut ke ronde berikutnya... ‚è≥";
                instructionEl.className = "text-xl text-gray-600 font-bold";
                
                // Mulai ulang setelah pesan singkat (total 2 detik lagi)
                setTimeout(() => {
                    startGame();
                }, 2000);
            }, 3000);
        }

        function runTimer(duration, colorClass, callback) {
            let start = Date.now();
            progressBar.className = `h-full transition-all duration-100 ease-linear`;
            if(colorClass === 'blue') progressBar.classList.add('bg-blue-500');
            if(colorClass === 'gray') progressBar.classList.add('bg-gray-500');
            if(colorClass === 'red') progressBar.classList.add('bg-red-500');

            if (timerInterval) clearInterval(timerInterval);

            timerInterval = setInterval(() => {
                let timePassed = Date.now() - start;
                let percentage = 100 - (timePassed / duration * 100);
                
                if (percentage <= 0) {
                    clearInterval(timerInterval);
                    progressBar.style.width = '0%';
                    callback();
                } else {
                    progressBar.style.width = percentage + '%';
                }
            }, 20);
        }
    </script>
</body>
</html>
